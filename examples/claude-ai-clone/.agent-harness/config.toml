# Claude.ai Clone - Agent Harness Configuration
# Recreates the original autonomous coding demo using the generic harness.

# --- Agent ---
model = "claude-sonnet-4-5-20250929"
system_prompt = "You are an expert full-stack developer building a production-quality web application."

# --- Session ---
max_turns = 1000
auto_continue_delay = 3

# --- Tools ---
[tools]
builtin = ["Read", "Write", "Edit", "Glob", "Grep", "Bash"]

[tools.mcp_servers.puppeteer]
command = "npx"
args = ["puppeteer-mcp-server"]

# --- Security ---
[security]
permission_mode = "acceptEdits"
allowed_paths = ["./**"]

[security.sandbox]
enabled = true
auto_allow_bash_if_sandboxed = true
allow_unsandboxed_commands = false

[security.sandbox.network]
allowed_domains = ["registry.npmjs.org", "github.com"]
allow_local_binding = true

[security.permissions]
allow = [
    "Bash(ls *)", "Bash(cat *)", "Bash(head *)", "Bash(tail *)", "Bash(wc *)", "Bash(grep *)",
    "Bash(cp *)", "Bash(mkdir *)", "Bash(chmod *)",
    "Bash(pwd)", "Bash(ps *)", "Bash(lsof *)", "Bash(sleep *)", "Bash(pkill *)",
    "Bash(npm *)", "Bash(node *)", "Bash(git *)",
    "Bash(./init.sh)",
]
deny = [
    "Bash(curl *)", "Bash(wget *)",
]

# --- Progress Tracking ---
[tracking]
type = "json_checklist"
file = "feature_list.json"
passing_field = "passes"

# --- Error Recovery ---
# Configures exponential backoff and circuit breaker for error handling
# [error_recovery]
# max_consecutive_errors = 5
# initial_backoff_seconds = 5.0
# max_backoff_seconds = 120.0
# backoff_multiplier = 2.0

# --- Phases ---
[[phases]]
name = "initializer"
prompt = "file:prompts/initializer.md"
run_once = true
condition = "not_exists:.agent-harness/feature_list.json"

[[phases]]
name = "coding"
prompt = "file:prompts/coding.md"

# --- Init Files ---
[[init_files]]
source = "prompts/app_spec.txt"
dest = "app_spec.txt"

# --- Post-Run Instructions ---
# Commands to show after the agent completes
post_run_instructions = [
    "npm install",
    "npm run dev",
]
